# Cloud-Init

ユーザーデータとメタデータは、RancherOSの起動プロセス中に、クラウドプロバイダー、VMランタイム、または管理サービスから取得できます。
v0.8.0以降、このプロセスはRancherOSがまだメモリから実行されていて、System Dockerが起動する前に発生します。
これは `rancher.cloud_init.datasources` 構成パラメーターによって構成されています。
AWSやGCEなどのクラウドプロバイダー固有のイメージの場合、データソースは事前設定されています。

### Userdata

Userdataは、RancherOSホストを起動したときにユーザーが指定したファイルです。
フォーマットによって異なる場所に保存されます。
userdataが `#cloud-config` で始まりYAML形式であることによって示される[cloud-config](https://rancher.com/docs/os/v1.x/en/installation/configuration/#cloud-config)ファイルである場合、それは `/var/lib/rancher/conf/cloud-config.d/boot.yml` に保存されます。
ユーザーデータが `#!` で始まるスクリプトである場合は、`/var/lib/rancher/conf/cloud-config-script` に保存されます。

### Metadata

詳細はプロバイダによって異なりますが、メタデータファイルには通常RancherOSホストに関する情報と追加の設定が含まれます。
RancherOSの主な目的は、SSHキーとホスト名設定の代替ソースを提供することです。
たとえば、AWSは一連の承認済みキーを使用してホストを起動し、RancherOSはこれらをメタデータを介して取得します。
メタデータは `/var/lib/rancher/conf/metadata` に格納されています。

## Configuration Load Order

[Cloud-config](https://rancher.com/docs/os/v1.x/en/installation/configuration/#cloud-config/)は、設定を取得する必要があるときにシステムサービスによって読み込まれます。
追加の各ファイルは、前の設定ファイルを上書きして拡張します。

1. `/usr/share/ros/os-config.yml` - これはシステムのデフォルト設定です。
これはユーザが変更してはいけません。

1. `/usr/share/ros/oem/oem-config.yml` - これは通常OEMによって存在しますが、ユーザーが変更することはできません。

1. `/var/lib/rancher/conf/cloud-config.d/`にあるファイルをファイル名順に並べます。
ファイルがuser-dataを通して渡されると、それはcloud-initによって書かれて `/var/lib/rancher/conf/cloud-config.d/boot.yml` として保存されます。

1. `rancher`で始まる名前のカーネルパラメータ。

1. `/var/lib/rancher/conf/metadata` - cloud-initによって追加されたメタデータ。



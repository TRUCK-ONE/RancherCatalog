# 動的Flexvolumeプラグイン検出

参考URL： [Flexvolume](https://github.com/kubernetes/community/blob/master/contributors/design-proposals/storage/flexvolume-deployment.md)

## 目的

新しいFlexvolumeプラグインを認識させるために、Kubeletとcontroller-managerを手動で再起動する必要はありません。

## Background

バージョン1.8から、Kubernetes Storage SIGはツリー内ボリュームプラグインの受け入れをやめ、すべてのストレージプロバイダにツリー外プラグインを実装するようアドバイスしています。
現在、推奨される実装は2つあります。
コンテナストレージインタフェース（CSI）とFlexvolumeです。

[CSI](ContainerStorageInterface00.md)は、ストレージソリューションがさまざまなコンテナーオーケストレーター間で機能するためにストレージベンダーが実装できる単一のインターフェイスを提供します。
ボリュームプラグインは設計上ツリー外です。
これは大きな努力であり、CSIの完全な実装は数分の一の距離にあり、そしてボリュームベンダーを追加し続けるための即時の解決策が必要です。

[Flexvolume](Flexvolume00.md)は、Kubernetesホスト上のユーザー指定のドライバに対してボリュームコマンドを実行することによって、任意のストレージソリューションを実行することができるツリー内プラグインです。
現在これが存在します。
ただし、Flexvolumeの設定プロセスは非常に手動で行われるため、多くのユーザーにとっては考慮されません。
問題には、ドライバを各ノードの特定の場所にコピーしなければならないこと、kubeletを手動で再起動すること、およびユーザーのマシンへの制限付きアクセスなどがあります。

自動展開手法については、推奨ドライバ展開方法で説明しています。
この方法を有効にするために必要な重要な変更は、kubeletとコントローラマネージャがプラグインの変更を動的に発見できるようにすることです。

## 概要

ドライバディレクトリの変更があると、kubeletまたはコントローラマネージャからファイルシステム監視に通知が送信されます。
kubeletまたはcontroller-managerがプラグインを探すとき（ボリュームをマウントする必要があるときなど）、監視からの信号があると、ドライバディレクトリを調べ、現在インストールされているドライバをボリュームプラグインとしてロードします。

変更は、ドライバのインストール（追加）、アップグレード/ダウングレード（更新）、またはアンインストール（削除）のいずれかです。 ボリュームが既存のドライバに依存している場合は、更新できますが削除はできません。

## Detailed Design

ボリュームプラグインコードで、単一のメソッド Init() を含むPluginStubインタフェースを導入し、それをVolumePluginに拡張させます。
PluginStubを拡張し、メソッド Init() および Probe() を含むPluginProber型を作成します。
ボリュームプラグインマネージャのプラグインリスト内のプラグインの種類をPluginStubに変更します。

---
以下略

---




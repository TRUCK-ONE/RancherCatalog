# Load Balancing and Ingresses

Rancher内では、サービス要求をリダイレクトするようにロードバランサと入力コントローラを設定できます。

## Load Balancerslin

アプリケーションを起動すると、そのアプリケーションはクラスタ内でのみ使用可能になります。
クラスタの外からはアクセスできません。

アプリケーションを外部からアクセス可能にする場合は、ロードバランサをクラスタに追加する必要があります。
ロードバランサーは、ユーザーがロードバランサーのIPアドレスとアプリケーションのポート番号を知っていれば、クラスタにアクセスするための外部接続用のゲートウェイを作成します。

Rancherは2種類のロードバランサをサポートしています。

- Layer-4 Load Balancers
- Layer-7 Load Balancers

詳しくは、ロードバランサーを参照してください。

### Load Balancer Limitations(ロードバランサの制限)

ロードバランサには、注意が必要ないくつかの制限があります。

- ロードバランサはサービスごとに1つのIPアドレスしか処理できません。
つまり、クラスタ内で複数のサービスを実行している場合は、サービスごとにロードバランサを用意する必要があります。
複数のロードバランサを実行すると、コストがかかる可能性があります。

- Hosted Kubernetesクラスタ（GKE、EKS、またはAKSでホストされているクラスタ）でロードバランサーを使用する場合は、同じクラウドプロバイダーでロードバランサーをホストする必要があります。
クラスターのプロビジョニング方法に基づいて、ロードバランサーのサポートに関する互換性表を確認してください。
    - Support for Layer-4 Load Balancing
    - Support for Layer-7 Load Balancing

## Ingress

上記の制限事項で述べたように、サービスごとにロードバランサーを使用するとコストがかかる可能性があります。
あなたはイングレスを使ってこの問題を回避することができます。

入力は、ロードバランサとして機能する一連のルールです。
入力は1つ以上の入力コントローラと連携してサービス要求を動的にルーティングします。
入力が要求を受信すると、クラスタ内の入力コントローラがロードバランサーをプログラムして、設定したサービスサブドメインまたはパスルールに基づいて要求を正しいサービスに転送します。

ロードバランサーは、クラスター内にも外部にも配置できます。
RKEランチャークラスタに存在する入力および入力コントローラはNginxによって動かされます。

イングレスは、SSL終了、名前ベースの仮想ホスティングなど、他の機能も提供できます。

> ### 高可用性構成でのRancherの使用
> ローカルクラスタにIngressを追加しないでください。
Rancherが使用するNginx Ingress Controllerは、ローカルクラスタを含む、Rancherが管理するすべてのクラスタのグローバルロードバランサとして機能します。
したがって、ユーザーがアプリケーションにアクセスしようとすると、Nginx構成が再ロードされるためにRancher接続が切断されることがあります。
Rancherを使用して起動したクラスターにのみアプリケーションをデプロイすることで、この問題を回避することをお勧めします。

- Rancherで入力を設定する方法の詳細については、Ingressを参照してください。

- 入力および入力コントローラの詳細については、[Kubernetes Ingress Documentation](https://kubernetes.io/docs/concepts/services-networking/ingress/) を参照してください。

